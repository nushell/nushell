# yaml-language-server: $schema=https://raw.githubusercontent.com/ast-grep/ast-grep/main/schemas/rule.json

id: if-matches
language: rust
severity: warning
message: "Used `matches!` macro as an `if` condition"

rule:
  pattern: "matches!($VAL, $$$PAT)"
  inside:
    field: condition
    kind: if_expression
    all:
      - not: { matches: has-else-if }
      - not: { inside: { kind: else_clause } }

utils:
  has-else-if:
    has:
      field: alternative
      kind: else_clause
      has:
        kind: if_expression

fix: "let $$$PAT = $VAL"
